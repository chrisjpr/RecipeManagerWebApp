{% extends 'base.html' %}
{% load static %}

{% block content %}
<h2>ğŸ‘¥ Friends Dashboard</h2>

<!-- Flash messages -->
{% if messages %}
  {% for message in messages %}
    <div class="message {{ message.tags }}">{{ message }}</div>
  {% endfor %}
{% endif %}

<!-- Current Friends Table -->
{% if friends %}
  <div class="card">
    <h3>âœ… Your Friends</h3>
    <table style="width: 100%; border-collapse: collapse;">
      <thead>
        <tr>
          <th style="text-align: left; padding: 0.5rem;">Username</th>
          <th style="text-align: center;">View Recipes</th>
          <th style="text-align: center;">Delete Friend</th>
        </tr>
      </thead>
      <tbody>
        {% for friend in friends %}
        <tr>
          <td style="padding: 0.5rem;">{{ friend.username }}</td>
          <td style="text-align: center;">
            <a href="{% url 'recipes:friends_recipes' friend.id %}" style="text-decoration: none; color: inherit;">ğŸ“–</a>
          </td>
          <td style="text-align: center;">
            <form method="post" action="{% url 'accounts:delete_friend' friend.id %}" onsubmit="return confirm('Are you sure you want to remove {{ friend.username }} as a friend?');">
              {% csrf_token %}
              <button type="submit" style="background-color: #dc3545; color: white; border: none; padding: 0.3rem 0.7rem; border-radius: 6px;">ğŸ—‘ï¸</button>
            </form>
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
{% else %}
  <p class="subtitle">You have no friends yet. ğŸ˜¢</p>
{% endif %}

<!-- Send Friend Request -->
<div class="card">
  <h3>â• Send Friend Request</h3>
  <form method="get" action="{% url 'accounts:friend_search' %}" style="display: flex; gap: 1rem;">
    <input type="text" name="q" placeholder="Search username" required>
    <button type="submit">ğŸ” Search</button>
  </form>
</div>

<!-- Search Results -->
{% if results %}
  <div class="card">
    <h4>ğŸ” Search Results</h4>
    <table style="width: 100%; border-collapse: collapse;">
      <thead>
        <tr>
          <th style="text-align: left; padding: 0.5rem;">Username</th>
          <th style="text-align: center;">Send Request</th>
        </tr>
      </thead>
      <tbody>
        {% for user in results %}
        <tr>
          <td style="padding: 0.5rem;">{{ user.username }}</td>
          <td style="text-align: center;">
            <form method="post" action="{% url 'accounts:send_friend_request' user.id %}">
              {% csrf_token %}
              <button type="submit">â•</button>
            </form>
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
{% endif %}

<!-- Incoming Friend Requests -->
{% if received_requests %}
  <div class="card">
    <h3>ğŸ“© Friend Requests (Received)</h3>
    <table style="width: 100%; border-collapse: collapse;">
      <thead>
        <tr>
          <th style="text-align: left; padding: 0.5rem;">Username</th>
          <th style="text-align: center;">Accept</th>
          <th style="text-align: center;">Decline</th>
        </tr>
      </thead>
      <tbody>
        {% for request in received_requests %}
        <tr>
          <td style="padding: 0.5rem;">{{ request.from_user.username }}</td>
          <td style="text-align: center;">
            <form method="post" action="{% url 'accounts:accept_friend_request' request.id %}">
              {% csrf_token %}
              <button type="submit" style="background-color: #28a745; color: white; border: none; padding: 0.3rem 0.7rem; border-radius: 6px;">âœ…</button>
            </form>
          </td>
          <td style="text-align: center;">
            <form method="post" action="{% url 'accounts:decline_friend_request' request.id %}">
              {% csrf_token %}
              <button type="submit" style="background-color: #dc3545; color: white; border: none; padding: 0.3rem 0.7rem; border-radius: 6px;">âŒ</button>
            </form>
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
{% endif %}

<!-- Sent Friend Requests -->
{% if sent_requests %}
  <div class="card">
    <h3>ğŸ“¤ Friend Requests (Sent)</h3>
    <table style="width: 100%; border-collapse: collapse;">
      <thead>
        <tr>
          <th style="text-align: left; padding: 0.5rem;">Username</th>
          <th style="text-align: center;">Status</th>
        </tr>
      </thead>
      <tbody>
        {% for request in sent_requests %}
        <tr>
          <td style="padding: 0.5rem;">{{ request.to_user.username }}</td>
          <td style="text-align: center;">Pending â³</td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
{% endif %}

{% endblock %}
